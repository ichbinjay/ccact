create database cocurract1;
use cocurract1;
show tables;

create table student (regno int, dno int, cid int, syear int);
alter table student add constraint pk1 primary key(regno);
desc student;
create table stuname (regno int, fname char(10), lname char(10));
desc stuname;

create table club (cid int, cname char(10), cphno int, competitions char(100));
alter table club add constraint pk1 primary key(cid);
desc club;

create table login (userid int, pword varchar(15));
alter table login add constraint pk1 primary key(userid);
desc login;

create table faculty (fid int);
alter table faculty add constraint pk1 primary key(fid);
desc faculty;

create table facname(fid int, fname char(10), lname char(10));
desc facname;

create table dept (dno int, dname char(10));
alter table dept add constraint pk1 primary key(dno);
desc dept;

create table competitions(cno int, cname char(10));
alter table competitions add constraint pk1 primary key(cno);
alter table competitions add column cid int ;
desc competitions;

create table participated(cno int, cname char(10), stat char(10));
alter table participated add column regno int;
desc participated;
select * from participated;

/* using foreign key approach for relationships; step 3 of mapping algorithm*/

alter table login add (regno int unique, fid int unique);
desc login;

alter table faculty add (dno int);
desc faculty;

alter table student add constraint fk2 foreign key(cid) references club(cid);
alter table stuname add constraint fk1 foreign key(regno) references student(regno);
alter table facname add constraint fk3 foreign key(fid) references faculty(fid);
alter table login add constraint fk4 foreign key(regno) references student(regno);
alter table login add constraint fk5 foreign key(fid) references faculty(fid);
alter table faculty add constraint fk6 foreign key(dno) references dept(dno);
alter table participated add constraint fk7 foreign key(cno) references competitions(cno);
alter table competitions add constraint fk9 foreign key(cid) references club(cid);
alter table participated add constraint fk10 foreign key(regno) references student(regno);

insert into student values
(1,1,1,1),
(2,1,2,2),
(3,1,1,2),
(4,2,2,3),
(5,2,1,1);

insert into participated values
(1,'comp1','win',1),
(2,'comp2','win',3),
(3,'comp3','part',2),
(3,'comp3','run',4),
(3,'comp3','part',1);

insert into stuname values
(1,'suresh','babu'),
(2,'manoj','reddy'),
(3,'sudarshan','kumar'),
(4,'vishnu','vardhan'),
(5,'jay','krishna');


insert into club values
(1,'innovative',12345678,'comp1'),
(2,'literary',23516283,'comp2');

insert into faculty values
(1041,1),
(1064,2),
(2021,2),
(2033,1),
(2012,2);

insert into dept values
(1,'cse'),
(2,'it');

insert into competitions values
(1,'comp1',1),
(2,'comp2',2),
(3,'comp3',2);

insert into facname values
(1041,'suri','babu'),
(2033,'bala','krishna'),
(1064,'ranjith','chava'),
(2012,'mahesh','babu'),
(2021,'rajesh','reddy');

select * from facname;
select * from faculty;
select * from login;
select * from participated;
select * from student;
select * from stuname;
select * from competitions;
select * from dept;
select * from club;

/*queries*/
select club.cname
from student, stuname, club
where stuname.fname = 'manoj' && student.regno = stuname.regno && student.cid = club.cid;


select dept.dname
from student, dept
where  student.regno = '2' && student.dno = dept.dno;

select  count(p.regno)
from participated p, competitions co
where p.cno = co.cno && co.cname = 'comp3';

select  count(cno)
from participated
where regno = 1;

select p.regno, s.fname, s.lname
from participated p, stuname s
where p.regno = s.regno
group by regno
having count(cno) > 1;

select s.fname, s.lname
from participated p, stuname s, dept d, student st, competitions co
where co.cno = p.cno && p.regno = st.regno && st.regno = s.regno && d.dno = st.dno && d.dname = 'cse' && co.cname = 'comp3';

select s.fname, s.lname, c.cname
from stuname s,  student st, club c, dept d
where d.dno = st.dno && st.regno = s.regno && st.cid = c.cid && d.dname = 'it';
